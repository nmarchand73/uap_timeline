---
import BaseLayout from '../../layouts/BaseLayout.astro';
import fs from 'node:fs';
import path from 'node:path';

const linksPath = path.join(process.cwd(), 'content', 'links.json');
const links = JSON.parse(fs.readFileSync(linksPath, 'utf-8'));
const dirdsPath = path.join(process.cwd(), 'content', 'dirds.json');
const dirds = JSON.parse(fs.readFileSync(dirdsPath, 'utf-8'));
const annualReportsPath = path.join(process.cwd(), 'content', 'annual-reports.json');
const annualReports = JSON.parse(fs.readFileSync(annualReportsPath, 'utf-8'));
---

<BaseLayout title="Sources officielles" description="25+ liens vers CIA, DNI, GEIPAN, Congrès, Defense.gov, Black Vault, NDAA, Wilson/Davis, Puthoff. 37 DIRD (AAWSAP/AATIP) avec PDF.">
  <h1>Sources officielles</h1>
  <p class="intro">Documents CIA, DNI, GEIPAN/COMETA, Congrès, Defense.gov, Black Vault, The Debrief. <a href="/dirds/" class="dirds-jump">37 DIRD (AAWSAP/AATIP) avec analyses ingénieurs →</a></p>

  <section class="dirds-section">
    <h2>DIRD — Defense Intelligence Reference Documents (AAWSAP/AATIP)</h2>
    <p class="section-desc">37 rapports scientifiques déclassifiés par la DIA (2008-2010). Programme AAWSAP/AATIP, contrat Bigelow (BAASS). Sources : <a href="https://www.theblackvault.com/documentarchive/the-advanced-aviation-threat-identification-program-aatip-dird-report-research/" target="_blank" rel="noopener noreferrer">The Black Vault</a>, <a href="https://irp.fas.org/dia/aatip-list.pdf" target="_blank" rel="noopener noreferrer">FAS</a>.</p>
    <div class="dirds-grid">
      {dirds.map((d: { id: number; title: string; author: string; affiliation: string; url: string }) => (
        <a href={`/dirds/${d.id}/`} class="dird-card">
          <span class="dird-num">DIRD {d.id}</span>
          <h3>{d.title}</h3>
          <p class="dird-author">{d.author} — {d.affiliation}</p>
        </a>
      ))}
    </div>
  </section>

  <section class="annual-reports-section">
    <h2>Rapports annuels UAP (UAPTF / AARO)</h2>
    <p class="section-desc">Rapports ODNI/DoD exigés par le NDAA. Preliminary Assessment (2021), puis rapports consolidés annuels. Autres publications AARO (Mission Brief, Info Papers).</p>
    <div class="annual-reports-grid">
      {annualReports.map((r: { year: string; title: string; url: string; date: string; summary: string; type?: string }) => (
        <a href={r.url} target="_blank" rel="noopener noreferrer" class="report-card">
          <span class="report-year">{r.year}{r.type === 'mission_brief' ? ' — Mission Brief' : r.type === 'info_paper' ? ' — Info Paper' : ''}</span>
          <h3>{r.title}</h3>
          <p class="report-summary">{r.summary}</p>
        </a>
      ))}
    </div>
  </section>

  <section class="links-section">
    <h2>Autres sources</h2>
    <div class="links-list">
      {links.map((l: { url: string; title: string; type: string; date: string | null }) => (
        <a href={l.url} target="_blank" rel="noopener noreferrer" class="link-card">
          <h3>{l.title}</h3>
          <p class="meta">{l.type}{l.date ? ` — ${l.date}` : ''}</p>
        </a>
      ))}
    </div>
  </section>
</BaseLayout>

<style>
  .intro {
    color: var(--text-muted);
    margin-bottom: 2rem;
  }

  .dirds-jump {
    font-weight: 600;
    color: var(--accent);
  }

  .dirds-jump:hover {
    text-decoration: underline;
  }

  .dirds-section {
    scroll-margin-top: 1rem;
    margin-bottom: 3rem;
  }

  .dirds-section h2 {
    font-size: 1.25rem;
    margin-bottom: 0.5rem;
  }

  .section-desc {
    color: var(--text-muted);
    font-size: 0.9rem;
    margin-bottom: 1.5rem;
    line-height: 1.5;
  }

  .section-desc a {
    color: var(--accent);
  }

  .dirds-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 0.75rem;
  }

  .dird-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 1rem 1.25rem;
    transition: border-color 0.2s, background 0.2s;
  }

  .dird-card:hover {
    border-color: var(--accent);
    background: var(--bg-elevated);
    text-decoration: none;
  }

  .dird-num {
    display: inline-block;
    font-size: 0.7rem;
    font-weight: 600;
    color: var(--accent);
    margin-bottom: 0.35rem;
  }

  .dird-card h3 {
    font-size: 0.9rem;
    margin: 0 0 0.4rem;
    line-height: 1.3;
  }

  .dird-author {
    font-size: 0.75rem;
    color: var(--text-muted);
    margin: 0;
  }

  .annual-reports-section {
    margin-bottom: 3rem;
  }

  .annual-reports-section h2 {
    font-size: 1.25rem;
    margin-bottom: 0.5rem;
  }

  .annual-reports-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1rem;
  }

  .report-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 1rem 1.25rem;
    transition: border-color 0.2s, background 0.2s;
    text-decoration: none;
  }

  .report-card:hover {
    border-color: var(--accent);
    background: var(--bg-elevated);
  }

  .report-year {
    display: inline-block;
    font-size: 0.7rem;
    font-weight: 600;
    color: var(--accent);
    margin-bottom: 0.35rem;
  }

  .report-card h3 {
    font-size: 0.95rem;
    margin: 0 0 0.5rem;
    line-height: 1.3;
    color: var(--text);
  }

  .report-summary {
    font-size: 0.8rem;
    color: var(--text-muted);
    margin: 0;
    line-height: 1.4;
  }

  .links-section h2 {
    font-size: 1.25rem;
    margin-bottom: 1rem;
  }

  .links-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1rem;
  }

  .link-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 1rem 1.25rem;
    transition: border-color 0.2s;
  }

  .link-card:hover {
    border-color: var(--accent);
    text-decoration: none;
  }

  .link-card h3 {
    font-size: 1rem;
    margin-bottom: 0.25rem;
  }

  .meta {
    font-size: 0.8rem;
    color: var(--text-muted);
    margin: 0;
  }
</style>
